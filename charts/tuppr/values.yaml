---
# Default values for tuppr - Talos Linux Upgrade Controller
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Number of controller replicas to run
# Note: Only one replica will be active due to leader election
replicaCount: 1

# Container image configuration
image:
  # Container image repository
  repository: ghcr.io/home-operations/tuppr
  # Image pull policy
  # Options: Always, Never, IfNotPresent
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: []
# Example:
# imagePullSecrets:
#   - name: my-registry-secret

# Override chart naming
nameOverride: ""
fullnameOverride: ""

# Kubernetes ServiceAccount configuration
# This is different from the Talos ServiceAccount above
serviceAccount:
  # Specifies whether a Kubernetes service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # Example annotations for workload identity:
  # annotations:
  #   iam.gke.io/gcp-service-account: tuppr@project.iam.gserviceaccount.com
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod annotations and labels
podAnnotations: {}
# Example:
# podAnnotations:
#   prometheus.io/scrape: "true"

podLabels: {}

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  fsGroup: 65532

# Additional environment variables passed to container
env: []
# - name: FOO
#   value: bar

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65532

# Service configuration
service:
  # Service type
  type: ClusterIP
  # Service port for general access
  port: 8080
  # Metrics port (deprecated - use controller.metrics.port)
  metricsPort: 8080

# Resource limits and requests
resources: {}
# Example:
# resources:
#   limits:
#     cpu: 500m
#     memory: 128Mi
#   requests:
#     cpu: 10m
#     memory: 64Mi

# Liveness probe configuration
livenessProbe:
  httpGet:
    path: /healthz
    port: 8081
  initialDelaySeconds: 15
  periodSeconds: 20

# Readiness probe configuration
readinessProbe:
  httpGet:
    path: /readyz
    port: 8081
  initialDelaySeconds: 5
  periodSeconds: 10

# Additional volumes on the output Deployment definition.
volumes: []
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

# Additional volumeMounts on the output Deployment definition.
volumeMounts: []
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

# Node selector for pod assignment
nodeSelector: {}
# Example:
# nodeSelector:
#   kubernetes.io/os: linux

# Tolerations for pod assignment
tolerations:
  - key: CriticalAddonsOnly
    operator: Exists
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule

# Affinity for pod assignment
affinity: {}
# Example:
# affinity:
#   nodeAffinity:
#     requiredDuringSchedulingIgnoredDuringExecution:
#       matchNodes:
#       - matchExpressions:
#         - key: kubernetes.io/arch
#           operator: In
#           values:
#           - amd64

# Controller-specific configuration
controller:
  # Log level for the controller
  # Options: info, debug
  logLevel: debug # TODO: Once there is a stable release, change this to info by default

  # Leader election configuration
  # Only one controller instance will be active at a time
  leaderElection:
    # Enable leader election (recommended for production)
    enabled: true

  # Metrics configuration
  metrics:
    # Enable Prometheus metrics endpoint
    enabled: true
    # Port for metrics endpoint
    port: 8080
    # Enable secure metrics (HTTPS with authentication)
    # When false, metrics are served over HTTP without authentication
    secure: false
    # Annotations for the metrics service
    annotations: {}
    # Example:
    # annotations:
    #   prometheus.io/scrape: "true"
    #   prometheus.io/port: "8080"

  # Health probe configuration
  health:
    # Port for health probes (/healthz, /readyz)
    port: 8081

# Webhook configuration
webhook:
  # Enable admission webhooks for validation
  enabled: true
  # Webhook server port
  port: 9443
  # Annotations for webhook service
  annotations: {}

# RBAC configuration
rbac:
  # Create ClusterRole and ClusterRoleBinding
  # Required for the controller to manage nodes and create jobs
  create: true
  # Annotations for RBAC resources
  annotations: {}

# Monitoring configuration
monitoring:
  # Prometheus ServiceMonitor for metrics scraping
  serviceMonitor:
    # Create ServiceMonitor resource
    # Requires Prometheus Operator to be installed
    enabled: false
    # Scrape interval
    interval: 30s
    # Scrape timeout
    scrapeTimeout: 10s
    # Metrics path
    path: /metrics
    # Additional labels for ServiceMonitor
    labels: {}
    # Example:
    # labels:
    #   prometheus: kube-prometheus
    # Annotations for ServiceMonitor
    annotations: {}

    # Advanced configuration (optional)
    # Metric relabelings to apply to scraped metrics
    metricRelabelings: []
    # Example:
    # metricRelabelings:
    #   - sourceLabels: [__name__]
    #     regex: 'tuppr_(.*)'
    #     targetLabel: __name__
    #     replacement: 'controller_${1}'

    # Relabelings to apply before scraping
    relabelings: []
    # Target labels to copy from the service
    targetLabels: []
    # Pod target labels to copy from pods
    podTargetLabels: []
